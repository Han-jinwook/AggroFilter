<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AggroFilter AutoMarketer ëŒ€ì‹œë³´ë“œ</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: #0f1117; color: #e2e8f0; min-height: 100vh; display: flex; flex-direction: column; }

    /* â•â• í—¤ë” â•â• */
    header {
      background: #1a1d2e; border-bottom: 1px solid #2d3748;
      padding: 0 24px; height: 60px;
      display: flex; align-items: center; gap: 0; flex-shrink: 0;
      position: relative;
    }
    .logo { display: flex; align-items: center; gap: 10px; white-space: nowrap; flex-shrink: 0; text-decoration: none; }
    .logo img { width: 38px; height: 38px; border-radius: 8px; }
    .logo-text { font-size: 16px; font-weight: 800; color: #a0aec0; letter-spacing: -.3px; }
    .logo-sub { font-size: 20px; font-weight: 900; color: #63b3ed; letter-spacing: -.5px; margin-left: 4px; }

    /* í—¤ë” ë„¤ë¹„ íƒ­ */
    .nav { display: flex; height: 100%; gap: 4px; align-items: center; position: absolute; left: 50%; transform: translateX(-50%); }
    .nav-btn {
      height: 100%; padding: 0 22px; font-size: 15px; font-weight: 700;
      cursor: pointer; border: none; background: transparent; color: #a0aec0;
      border-bottom: 3px solid transparent;
      transition: color .15s, border-color .15s;
      display: flex; align-items: center; gap: 7px;
    }
    .nav-btn:hover { color: #e2e8f0; }
    .nav-btn.active { color: #63b3ed; border-bottom-color: #63b3ed; }

    .header-right { margin-left: auto; display: flex; align-items: center; gap: 8px; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.6} }

    /* ì˜¤í† ëª¨ë“œ í† ê¸€ */
    .auto-toggle-wrap { display: flex; align-items: center; gap: 10px; background: #0f1117; border: 1px solid #2d3748; border-radius: 8px; padding: 8px 14px; }
    .auto-toggle-label { font-size: 13px; font-weight: 700; color: #a0aec0; }
    .auto-toggle-label.on { color: #68d391; }
    .toggle-switch { position: relative; width: 44px; height: 24px; cursor: pointer; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .toggle-track {
      position: absolute; inset: 0; background: #2d3748; border-radius: 24px;
      transition: background .25s;
    }
    .toggle-switch input:checked + .toggle-track { background: #276749; }
    .toggle-thumb {
      position: absolute; top: 3px; left: 3px;
      width: 18px; height: 18px; border-radius: 50%;
      background: #718096; transition: transform .25s, background .25s;
    }
    .toggle-switch input:checked ~ .toggle-thumb { transform: translateX(20px); background: #68d391; }

    /* â•â• ì»¨íŠ¸ë¡¤ ì˜ì—­ â•â• */
    .control-bar {
      background: #0f1117; border-bottom: 1px solid #2d3748;
      padding: 12px 24px; display: flex; gap: 14px; flex-shrink: 0;
    }

    /* ì¹´ë“œ ê³µí†µ */
    .card {
      background: #1a1d2e; border: 2px solid #4a5568; border-radius: 10px;
      padding: 14px 16px;
    }
    .card-title {
      font-size: 15px; font-weight: 800; color: #63b3ed;
      letter-spacing: .2px; margin-bottom: 12px;
    }

    /* í˜„í™© ì¹´ë“œ (ì¢Œ) */
    .status-card { flex: 0 0 auto; min-width: 380px; }
    .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .stat-item { background: #0f1117; border-radius: 7px; padding: 8px 12px; }
    .stat-label { font-size: 12px; color: #a0aec0; font-weight: 600; margin-bottom: 4px; }
    .stat-value { font-size: 14px; font-weight: 700; color: #e2e8f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .stat-value.running { color: #63b3ed; }
    .stat-value.ok { color: #9ae6b4; }
    .stat-value.err { color: #fc8181; }
    .run-btn-wrap { margin-top: 10px; display: flex; gap: 6px; }

    /* ì„¤ì • ì¹´ë“œ (ìš°) */
    .settings-card { flex: 1; }
    .opt-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .opt-item { display: flex; flex-direction: column; gap: 5px; }
    .opt-item label { font-size: 12px; color: #cbd5e0; font-weight: 600; }
    .opt-item input {
      padding: 7px 8px; background: #0f1117; border: 1px solid #2d3748;
      border-radius: 6px; color: #e2e8f0; font-size: 14px; text-align: center;
      width: 100%;
    }
    .opt-item input:focus { outline: none; border-color: #4299e1; }
    .opt-item .hint { font-size: 12px; color: #63b3ed; line-height: 1.5; font-style: italic; }
    .settings-footer { margin-top: 10px; display: flex; align-items: center; gap: 8px; }
    .schedule-note { font-size: 13px; color: #68d391; font-weight: 600; margin-left: auto; }

    /* ë²„íŠ¼ */
    .btn {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 7px 16px; border-radius: 7px; font-size: 12px;
      font-weight: 700; cursor: pointer; border: none; transition: opacity .15s;
      white-space: nowrap;
    }
    .btn:hover { opacity: .82; }
    .btn:disabled { opacity: .35; cursor: not-allowed; }
    .btn-primary { background: #3182ce; color: #fff; }
    .btn-success { background: #276749; color: #9ae6b4; }
    .btn-danger  { background: #742a2a; color: #fc8181; }
    .btn-ghost   { background: #2d3748; color: #cbd5e0; border: 1px solid #4a5568; }
    .btn-sm { padding: 5px 11px; font-size: 11px; }

    /* â•â• ë©”ì¸ ì½˜í…ì¸  â•â• */
    .main-content {
      flex: 1; overflow: hidden; display: flex; flex-direction: column;
      padding: 12px 24px 16px;
    }
    .tab-content { display: none; flex: 1; flex-direction: column; overflow: hidden; }
    .tab-content.active { display: flex; }

    .table-toolbar { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .table-toolbar span { font-size: 12px; color: #718096; }

    /* í…Œì´ë¸” */
    .table-wrap { flex: 1; overflow-y: auto; border: 1px solid #2d3748; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    thead { position: sticky; top: 0; z-index: 1; }
    th {
      text-align: left; padding: 9px 12px;
      background: #0d0f1a; color: #cbd5e0; font-weight: 700; font-size: 13px;
      white-space: nowrap;
      border-bottom: 1px solid #2d3748;
    }
    td { padding: 8px 12px; border-bottom: 1px solid #161928; vertical-align: middle; color: #e2e8f0; font-size: 13px; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: #1a1d2e; }

    .score { display: inline-block; padding: 3px 9px; border-radius: 4px; font-weight: 700; font-size: 12px; }
    .score-high { background: #1c4532; color: #9ae6b4; }
    .score-mid  { background: #3d2b00; color: #fbd38d; }
    .score-low  { background: #3d0f0f; color: #fc8181; }
    .score-none { color: #4a5568; }

    .cell-title { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 0; width: 100%; }
    .cell-title a { color: #63b3ed; text-decoration: none; }
    .cell-title a:hover { text-decoration: underline; }
    .cell-ch { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .cell-ch a { color: #a0aec0; text-decoration: none; }
    .cell-ch a:hover { color: #63b3ed; }
    .cell-time { white-space: nowrap; color: #a0aec0; font-size: 12px; font-variant-numeric: tabular-nums; }

    .empty { text-align: center; padding: 60px 0; color: #4a5568; font-size: 13px; }

    /* ì»¤ë®¤ë‹ˆí‹° */
    .community-wrap { display: flex; flex-direction: column; gap: 10px; flex: 1; overflow: hidden; }
    .add-form {
      background: #1a1d2e; border: 1px solid #2d3748; border-radius: 8px;
      padding: 10px 14px; display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end;
    }
    .add-form .fg { display: flex; flex-direction: column; gap: 4px; flex: 1; min-width: 140px; }
    .add-form .fg label { font-size: 11px; color: #718096; }
    .add-form .fg input {
      padding: 6px 8px; background: #0f1117; border: 1px solid #2d3748;
      border-radius: 5px; color: #e2e8f0; font-size: 12px;
    }
    .kw-badge {
      display: inline-block; background: #2d3748; color: #e2e8f0;
      border-radius: 3px; padding: 1px 6px; font-size: 10px; margin: 1px;
    }

    /* ëŒ“ê¸€ ë¡œê·¸ */
    .status-dot { display: inline-block; width: 7px; height: 7px; border-radius: 50%; margin-right: 4px; }
    .dot-queue { background: #ecc94b; }
    .dot-done  { background: #48bb78; }
    .dot-error { background: #fc8181; }
    .dot-skipped { background: #718096; }

    /* í† ìŠ¤íŠ¸ */
    .toast {
      position: fixed; bottom: 20px; right: 20px;
      background: #1a1d2e; border: 1px solid #4a5568;
      border-radius: 8px; padding: 10px 18px;
      font-size: 12px; color: #e2e8f0;
      box-shadow: 0 4px 24px rgba(0,0,0,.6);
      opacity: 0; transition: opacity .2s; pointer-events: none; z-index: 9999;
    }
    .toast.show { opacity: 1; }
    .toast.ok { border-color: #276749; color: #9ae6b4; }
    .toast.err { border-color: #742a2a; color: #fc8181; }

    .opt-sep { width: 1px; height: 20px; background: #2d3748; }

    /* â”€â”€ ê°€ì´ë“œ ëª¨ë‹¬ â”€â”€ */
    .modal-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,.65); z-index: 9000;
      align-items: center; justify-content: center;
    }
    .modal-overlay.open { display: flex; }
    .modal-box {
      background: #1a1d2e; border: 1px solid #2d3748;
      border-radius: 12px; width: 720px; max-width: 95vw;
      max-height: 88vh; display: flex; flex-direction: column;
      box-shadow: 0 20px 60px rgba(0,0,0,.6);
    }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 24px; border-bottom: 1px solid #2d3748;
    }
    .modal-header h2 { font-size: 16px; font-weight: 700; color: #fff; }
    .modal-close {
      background: none; border: none; color: #718096;
      font-size: 20px; cursor: pointer; line-height: 1;
      padding: 4px 8px; border-radius: 4px;
    }
    .modal-close:hover { background: #2d3748; color: #fff; }
    .modal-body {
      padding: 24px; overflow-y: auto; flex: 1;
      font-size: 13px; line-height: 1.75; color: #cbd5e0;
    }
    .modal-body h3 {
      font-size: 13px; font-weight: 700; color: #63b3ed;
      margin: 20px 0 8px; padding-bottom: 4px;
      border-bottom: 1px solid #2d3748;
    }
    .modal-body h3:first-child { margin-top: 0; }
    .modal-body ul { padding-left: 18px; }
    .modal-body ul li { margin-bottom: 5px; }
    .modal-body code {
      background: #0f1117; border: 1px solid #2d3748;
      border-radius: 4px; padding: 1px 6px;
      font-family: 'Courier New', monospace; font-size: 12px; color: #f6ad55;
    }
    .guide-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    .guide-table th {
      background: #0f1117; color: #718096; font-size: 11px;
      padding: 6px 10px; text-align: left; font-weight: 500;
    }
    .guide-table td { padding: 7px 10px; border-bottom: 1px solid #1e2335; }
    .guide-table tr:last-child td { border-bottom: none; }
    .g-badge {
      display: inline-block; padding: 2px 8px; border-radius: 4px;
      font-size: 11px; font-weight: 700;
    }
    .g-A { background: #276749; color: #9ae6b4; }
    .g-B { background: #2b4c7e; color: #90cdf4; }
    .g-C { background: #744210; color: #fbd38d; }
    .btn-guide {
      margin-left: auto; background: #2d3748; color: #e2e8f0;
      border: 1px solid #4a5568;
    }
    .btn-guide:hover { background: #4a5568; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• í—¤ë” â•â•â•â•â•â•â•â•â•â• -->
<header>
  <div class="logo">
    <img src="/character-logo.png" alt="AggroFilter" />
    <span class="logo-text">AggroFilter</span>
    <span class="logo-sub">AutoMarketer</span>
  </div>
  <nav class="nav">
    <button class="nav-btn active" onclick="switchTab('collected',this)">ğŸ“‹ ìˆ˜ì§‘ ë¦¬ìŠ¤íŠ¸</button>
    <button class="nav-btn" onclick="switchTab('community',this)">ğŸ¯ ì»¤ë®¤ë‹ˆí‹° íƒ€ê²Ÿ</button>
    <button class="nav-btn" onclick="switchTab('comments',this)">ğŸ’¬ ëŒ“ê¸€ ë¡œê·¸</button>
  </nav>
  <div class="header-right">
    <button class="btn btn-ghost btn-sm" onclick="openGuide()">ğŸ“– ê°€ì´ë“œ</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â• ì»¨íŠ¸ë¡¤ ì˜ì—­ â•â•â•â•â•â•â•â•â•â• -->
<div class="control-bar">

  <!-- ì¢Œ: í˜„í™© ì¹´ë“œ -->
  <div class="card status-card">
    <div class="card-title">ğŸ“Š ë´‡ í˜„í™©</div>
    <div class="auto-toggle-wrap" style="margin-bottom:10px">
      <span class="auto-toggle-label" id="autoModeLabel">ì˜¤í† ëª¨ë“œ OFF</span>
      <label class="toggle-switch">
        <input type="checkbox" id="autoModeToggle" onchange="toggleAutoMode(this)" />
        <div class="toggle-track"></div>
        <div class="toggle-thumb"></div>
      </label>
      <span id="autoModeBadge" style="font-size:12px;color:#4a5568">ìˆ˜ë™ ì‹¤í–‰ ì „ìš©</span>
    </div>
    <div class="status-grid">
      <div class="stat-item">
        <div class="stat-label">í˜„ì¬ ìƒíƒœ</div>
        <div class="stat-value" id="statusText">ëŒ€ê¸° ì¤‘</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ë§ˆì§€ë§‰ ì‹¤í–‰</div>
        <div class="stat-value" id="lastRun">â€”</div>
      </div>
      <div class="stat-item" style="grid-column:1/-1">
        <div class="stat-label">ë§ˆì§€ë§‰ ê²°ê³¼</div>
        <div class="stat-value" id="lastResult">â€”</div>
      </div>
    </div>
    <div class="run-btn-wrap">
      <button class="btn btn-success" id="btnRunType1" onclick="runNow('type1')">â–¶ Type1 ì‹¤í–‰ <span style="font-size:11px;opacity:.75">(ì „ì²´ íŠ¸ë Œë“œ)</span></button>
      <button class="btn btn-success" id="btnRunType2" onclick="runNow('type2')" style="background:#276749">â–¶ Type2 ì‹¤í–‰ <span style="font-size:11px;opacity:.75">(ì¹´í…Œê³ ë¦¬ë³„)</span></button>
      <button class="btn btn-ghost btn-sm" onclick="loadCollected()" style="margin-left:auto">â†» ìƒˆë¡œê³ ì¹¨</button>
    </div>
  </div>

  <!-- ìš°: ìˆ˜ì§‘ ì„¤ì • ì¹´ë“œ -->
  <div class="card settings-card">
    <div class="card-title">âš™ï¸ ìˆ˜ì§‘ ì„¤ì •</div>
    <div class="opt-grid">
      <div class="opt-item">
        <label>N â€” ì „ì²´ íŠ¸ë Œë“œ</label>
        <input type="number" id="optN" min="1" max="50" />
        <div class="hint">Type1 ìˆ˜ì§‘ ê°œìˆ˜</div>
      </div>
      <div class="opt-item">
        <label>M â€” ì¹´í…Œê³ ë¦¬ë³„</label>
        <input type="number" id="optM" min="1" max="20" />
        <div class="hint">15ê°œ ì¹´í…Œê³ ë¦¬ Ã— M</div>
      </div>
      <div class="opt-item">
        <label>X â€” ì±„ë„ ì¿¨íƒ€ì„(ì¼)</label>
        <input type="number" id="optX" min="1" max="30" />
        <div class="hint">ë™ì¼ ì±„ë„ ì¬ìˆ˜ì§‘ ë°©ì§€</div>
      </div>
      <div class="opt-item">
        <label>ë”œë ˆì´ (ms)</label>
        <input type="number" id="optDelay" min="1000" step="500" />
        <div class="hint">API Rate Limit ë°©ì–´</div>
      </div>
    </div>
    <div class="settings-footer">
      <button class="btn btn-primary btn-sm" onclick="saveOptions()">ğŸ’¾ ì €ì¥</button>
      <span class="schedule-note">ğŸ• ìë™ ìŠ¤ì¼€ì¤„: ë§¤ì¼ 06:00 / 18:00 KST</span>
    </div>
  </div>

</div>

<!-- ê°€ì´ë“œ ëª¨ë‹¬ -->
<div class="modal-overlay" id="guideModal" onclick="closeGuideOutside(event)">
  <div class="modal-box">
    <div class="modal-header">
      <h2>ğŸ“– AutoMarketer ì‚¬ìš© ê°€ì´ë“œ</h2>
      <button class="modal-close" onclick="closeGuide()">âœ•</button>
    </div>
    <div class="modal-body">

      <h3>ğŸ—‚ ì „ì²´ êµ¬ì¡°</h3>
      <ul>
        <li><strong>ì„¹ì…˜0 â€” ëŒ€ì‹œë³´ë“œ</strong>: ì´ í™”ë©´. ë´‡ ìƒíƒœ í™•ì¸, ì˜µì…˜ ì œì–´, ìˆ˜ì§‘/ëŒ“ê¸€ í˜„í™© ëª¨ë‹ˆí„°ë§</li>
        <li><strong>ì„¹ì…˜1 â€” YouTube ìˆ˜ì§‘Â·ë¶„ì„</strong>: íŠ¸ë Œë“œ ì˜ìƒì„ ìˆ˜ì§‘í•´ AggroFilter ë©”ì¸ ì•±ì— ë¶„ì„ ìš”ì²­</li>
        <li><strong>ì„¹ì…˜2 â€” ëŒ“ê¸€ ìë™í™”</strong>: ë¶„ì„ ì™„ë£Œ ì˜ìƒì— ìœ íŠœë¸Œ ëŒ“ê¸€ + ì—í¨ì½”ë¦¬ì•„ ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ìë™ ì‘ì„±</li>
      </ul>

      <h3>âš™ï¸ ìˆ˜ì§‘ ì˜µì…˜ (N / M / X)</h3>
      <table class="guide-table">
        <thead><tr><th>íŒŒë¼ë¯¸í„°</th><th>ì˜ë¯¸</th><th>ê¸°ë³¸ê°’</th><th>ê¶Œì¥ ë²”ìœ„</th></tr></thead>
        <tbody>
          <tr><td><code>N</code></td><td>YouTube ì „ì²´ íŠ¸ë Œë“œ ìˆ˜ì§‘ ê°œìˆ˜ (Type1) â€” <strong>ì—…ë¡œë“œ 12ì‹œê°„ ì´ë‚´</strong> ì¸ê¸° ì˜ìƒë§Œ ëŒ€ìƒ</td><td>10</td><td>5 ~ 30</td></tr>
          <tr><td><code>M</code></td><td>ì¹´í…Œê³ ë¦¬ë³„ ìˆ˜ì§‘ ê°œìˆ˜ (Type2, ìœ íŠœë¸Œ ê³µì‹ <strong>15ê°œ</strong> ì¹´í…Œê³ ë¦¬ ì „ì²´) â€” <strong>ì—…ë¡œë“œ 12ì‹œê°„ ì´ë‚´</strong> ìµœê³  ì¡°íšŒìˆ˜ ìˆœ</td><td>3</td><td>1 ~ 10</td></tr>
          <tr><td><code>X</code></td><td>ì±„ë„ ì¿¨íƒ€ì„ (ì¼) â€” ë™ì¼ ì±„ë„ ì¬ìˆ˜ì§‘ ë°©ì§€</td><td>7</td><td>3 ~ 14</td></tr>
          <tr><td><code>ë”œë ˆì´</code></td><td>ë¶„ì„ ìš”ì²­ ê°„ê²© (ms) â€” API Rate Limit ë°©ì–´</td><td>5000</td><td>3000 ~ 10000</td></tr>
        </tbody>
      </table>
      <ul style="margin-top:10px">
        <li>ë³€ê²½ í›„ ë°˜ë“œì‹œ <strong>ğŸ’¾ ì €ì¥</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë‹¤ìŒ ì‹¤í–‰ì— ì ìš©ë©ë‹ˆë‹¤.</li>
        <li>Type1 + Type2 í•©ì‚° ìµœëŒ€ ìˆ˜ì§‘ëŸ‰ = <code>N + MÃ—15</code>ê°œ (ì¤‘ë³µ ì œê±° í›„)</li>
        <li>ìˆ˜ì§‘ ëŒ€ìƒì€ <strong>ì—…ë¡œë“œ í›„ 12ì‹œê°„ ì´ë‚´</strong> ì˜ìƒìœ¼ë¡œ í•œì • â€” ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ì‹œë§ˆë‹¤ ìµœì‹  íŠ¸ë Œë“œë§Œ ë¶„ì„</li>
      </ul>

      <h3>ğŸ¤– ìë™ ìŠ¤ì¼€ì¤„</h3>
      <ul>
        <li>ë§¤ì¼ <strong>ì˜¤ì „ 6:00 / ì˜¤í›„ 6:00 (KST)</strong> ìë™ ì‹¤í–‰ â€” Type1+2 í•©ì‚°</li>
        <li>ì‹¤í–‰ ìˆœì„œ: ìˆ˜ì§‘ â†’ ì¤‘ë³µ ì œê±° â†’ ìë§‰ ìˆ˜ì§‘ â†’ ë¶„ì„ ë“±ë¡ (ìë§‰ ì—†ëŠ” ì˜ìƒ ìë™ ì œì™¸)</li>
        <li>ëŒ“ê¸€/ì»¤ë®¤ë‹ˆí‹° ìë™í™”ëŠ” <strong>2ì°¨ ëª¨ë“ˆ</strong>ì—ì„œ ë³„ë„ ì„¤ì • ì˜ˆì •</li>
      </ul>
      <h3>â–¶ ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼</h3>
      <ul>
        <li><strong>Type1 ì‹¤í–‰</strong>: ì „ì²´ íŠ¸ë Œë“œ(mostPopular) Nê°œ ìˆ˜ì§‘ í›„ ë¶„ì„</li>
        <li><strong>Type2 ì‹¤í–‰</strong>: 15ê°œ ì¹´í…Œê³ ë¦¬ë³„ Mê°œì”© ìˆ˜ì§‘ í›„ ë¶„ì„</li>
        <li>ë‘ ë²„íŠ¼ ëª¨ë‘ ì €ì¥ëœ N/M/X/ë”œë ˆì´ ì„¤ì •ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©</li>
      </ul>

      <h3>ğŸ’¬ ìœ íŠœë¸Œ ëŒ“ê¸€ ë“±ê¸‰ ê¸°ì¤€</h3>
      <table class="guide-table">
        <thead><tr><th>ë“±ê¸‰</th><th>ì‹ ë¢°ë„ ì ìˆ˜</th><th>ëŒ“ê¸€ ë°©í–¥</th></tr></thead>
        <tbody>
          <tr>
            <td><span class="g-badge g-A">A</span></td>
            <td>70ì  ì´ìƒ (ê³ ì‹ ë¢°)</td>
            <td>"ì´ ì˜ìƒ ë¯¿ì„ ë§Œí•˜ë„¤ìš”" ë¥˜ â€” AggroFilter ë§í¬ë¡œ ê²€ì¦ ìœ ë„</td>
          </tr>
          <tr>
            <td><span class="g-badge g-B">B</span></td>
            <td>40~69ì  (ì¤‘ê°„)</td>
            <td>"íŒ©íŠ¸ì²´í¬ í•œë²ˆ í•´ë´¤ëŠ”ë°..." ë¥˜ â€” ê¶ê¸ˆì¦ ìœ ë°œ</td>
          </tr>
          <tr>
            <td><span class="g-badge g-C">C</span></td>
            <td>39ì  ì´í•˜ (ì €ì‹ ë¢°)</td>
            <td>"ì´ëŸ° ì˜ìƒ ì¡°ì‹¬í•˜ì„¸ìš”" ë¥˜ â€” ì–´ê·¸ë¡œ ê²½ê³  + ë§í¬</td>
          </tr>
        </tbody>
      </table>
      <ul style="margin-top:10px">
        <li>ëŒ“ê¸€ì— ì‚½ì…ë˜ëŠ” ë§í¬: <code>https://aggrofilter.com/result/{videoId}</code></li>
        <li>ëŒ“ê¸€ ì‚¬ì´ ë”œë ˆì´: <strong>1~2ë¶„ ëœë¤</strong> (ìŠ¤íŒ¸ ë°©ì§€)</li>
      </ul>

      <h3>ğŸ¯ ì»¤ë®¤ë‹ˆí‹° íƒ€ê²Ÿ ê´€ë¦¬</h3>
      <ul>
        <li>ì—í¨ì½”ë¦¬ì•„ ê²Œì‹œíŒ URL + íƒì§€ í‚¤ì›Œë“œë¥¼ ë“±ë¡í•´ë‘ë©´ ë´‡ì´ ìë™ìœ¼ë¡œ í•´ë‹¹ ê²Œì‹œê¸€ì„ ì°¾ì•„ ëŒ“ê¸€ ì‘ì„±</li>
        <li>í‚¤ì›Œë“œëŠ” ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„ â€” ì˜ˆ: <code>ê°€ì§œë‰´ìŠ¤, ìœ íŠœë¸Œ ë‚šì‹œ, ì–´ê·¸ë¡œ</code></li>
        <li>ìµœê·¼ <strong>24ì‹œê°„ ì´ë‚´</strong> ê²Œì‹œê¸€ë§Œ ëŒ€ìƒ (ì˜¤ë˜ëœ ê¸€ ìŠ¤íŒ¸ ë°©ì§€)</li>
        <li>í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ë¡œ íƒ€ê²Ÿë³„ on/off ì œì–´ ê°€ëŠ¥</li>
        <li>ëŒ“ê¸€ ë‚´ìš©ì€ <strong>Gemini AI</strong>ê°€ ê²Œì‹œê¸€ ë³¸ë¬¸ì„ ì½ê³  ìì—°ìŠ¤ëŸ½ê²Œ ìƒì„±</li>
      </ul>

      <h3>ğŸ” í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ (.env)</h3>
      <table class="guide-table">
        <thead><tr><th>ë³€ìˆ˜ëª…</th><th>ìš©ë„</th></tr></thead>
        <tbody>
          <tr><td><code>YOUTUBE_API_KEY</code></td><td>YouTube Data API v3 í‚¤</td></tr>
          <tr><td><code>DATABASE_URL</code></td><td>Supabase PostgreSQL ì—°ê²° URL</td></tr>
          <tr><td><code>GEMINI_API_KEY</code></td><td>ì—í¨ì½”ë¦¬ì•„ ëŒ“ê¸€ AI ìƒì„±ìš©</td></tr>
          <tr><td><code>CHROME_USER_DATA_DIR</code></td><td>í¬ë¡¬ ì‚¬ìš©ì ë°ì´í„° ê²½ë¡œ (Playwright ì„¸ì…˜ ì¬ì‚¬ìš©)</td></tr>
          <tr><td><code>MAIN_APP_URL</code></td><td>AggroFilter ë©”ì¸ ì•± URL</td></tr>
        </tbody>
      </table>
      <ul style="margin-top:10px">
        <li>í¬ë¡¬ ê²½ë¡œ í™•ì¸: í¬ë¡¬ ì£¼ì†Œì°½ì— <code>chrome://version/</code> â†’ <strong>í”„ë¡œí•„ ê²½ë¡œ</strong> í•­ëª©</li>
        <li>Playwright ì²« ì‹¤í–‰ ì „ í¬ë¡¬ì—ì„œ <strong>ìœ íŠœë¸Œ + ì—í¨ì½”ë¦¬ì•„ ë¡œê·¸ì¸</strong> í•„ìˆ˜</li>
      </ul>

      <h3>âš ï¸ ìš´ì˜ ì£¼ì˜ì‚¬í•­</h3>
      <ul>
        <li>ëŒ“ê¸€ ì‘ì„±ì€ <strong>Playwright(ì‹¤ì œ ë¸Œë¼ìš°ì €)</strong>ë¡œ ë™ì‘ â€” í¬ë¡¬ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì—´ë¦¼</li>
        <li>YouTube/ì—í¨ì½”ë¦¬ì•„ ì •ì±… ë³€ê²½ ì‹œ ì…€ë ‰í„° ìˆ˜ì • í•„ìš” (<code>youtube-commenter.js</code>, <code>fmkorea-commenter.js</code>)</li>
        <li>Gemini API ë¬´ë£Œ í•œë„: ë¶„ë‹¹ 15íšŒ â€” ì—í¨ì½”ë¦¬ì•„ ìŠ¤ìº” ê²Œì‹œê¸€ì´ ë§ìœ¼ë©´ 503 ë°œìƒ ê°€ëŠ¥ (ìë™ ì¬ì‹œë„ ì—†ìŒ)</li>
        <li>ì±„ë„ ì¿¨íƒ€ì„(X)ì„ ë„ˆë¬´ ë‚®ê²Œ ì„¤ì •í•˜ë©´ ë™ì¼ ì±„ë„ì— ë°˜ë³µ ëŒ“ê¸€ ìœ„í—˜</li>
      </ul>

    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ë©”ì¸ ì½˜í…ì¸  â•â•â•â•â•â•â•â•â•â• -->
<div class="main-content">

  <!-- íƒ­1: ìˆ˜ì§‘ ë¦¬ìŠ¤íŠ¸ -->
  <div id="tab-collected" class="tab-content active">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span style="font-size:14px;font-weight:700;color:#cbd5e0">ë´‡(user_id=bot) ë¶„ì„ ì˜ìƒ ìµœì‹  200ê°œ</span>
      <button class="btn btn-ghost btn-sm" onclick="loadCollected()">â†» ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <div class="table-wrap" id="tableWrap"><div class="empty">ë¡œë”© ì¤‘...</div></div>
  </div>

  <!-- íƒ­2: ì»¤ë®¤ë‹ˆí‹° íƒ€ê²Ÿ -->
  <div id="tab-community" class="tab-content">
    <div class="community-wrap">
      <div class="add-form">
        <div class="fg">
          <label>ì»¤ë®¤ë‹ˆí‹° URL</label>
          <input type="text" id="newUrl" placeholder="https://www.fmkorea.com/index.php?mid=humor" />
        </div>
        <div class="fg">
          <label>í‚¤ì›Œë“œ (ì‰¼í‘œ êµ¬ë¶„)</label>
          <input type="text" id="newKeywords" placeholder="ê°€ì§œë‰´ìŠ¤, ìœ íŠœë¸Œ ë‚šì‹œ, ì–´ê·¸ë¡œ" />
        </div>
        <div class="fg" style="max-width:120px">
          <label>ë©”ëª¨</label>
          <input type="text" id="newNote" placeholder="ì—í¨ ìœ ë¨¸" />
        </div>
        <button class="btn btn-success" onclick="addTarget()">+ ì¶”ê°€</button>
      </div>
      <div class="table-wrap" id="targetList"><div class="empty">ë¡œë”© ì¤‘...</div></div>
    </div>
  </div>

  <!-- íƒ­3: ëŒ“ê¸€ ë¡œê·¸ -->
  <div id="tab-comments" class="tab-content">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <button class="btn btn-ghost btn-sm" onclick="loadCommentLogs()">â†» ìƒˆë¡œê³ ì¹¨</button>
      <select id="logStatusFilter" onchange="loadCommentLogs()"
        style="background:#0f1117;border:1px solid #2d3748;color:#e2e8f0;padding:4px 8px;border-radius:5px;font-size:11px">
        <option value="">ì „ì²´</option>
        <option value="queue">ëŒ€ê¸°(Queue)</option>
        <option value="done">ì™„ë£Œ(Done)</option>
        <option value="error">ì˜¤ë¥˜(Error)</option>
        <option value="skipped">ìŠ¤í‚µ(Skipped)</option>
      </select>
      <span style="font-size:11px;color:#718096;margin-left:auto">ìµœê·¼ 200ê°œ</span>
    </div>
    <div class="table-wrap" id="commentLogWrap"><div class="empty">ë¡œë”© ì¤‘...</div></div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
  let pollingTimer = null;

  async function fetchStatus() {
    try {
      const res = await fetch('/api/status');
      const { status, options } = await res.json();

      // ì˜¤í† ëª¨ë“œ í† ê¸€ ìƒíƒœ ë°˜ì˜
      const autoOn = status.autoMode ?? false;
      const toggle = document.getElementById('autoModeToggle');
      const label = document.getElementById('autoModeLabel');
      const modeBadge = document.getElementById('autoModeBadge');
      if (toggle) toggle.checked = autoOn;
      if (label) { label.textContent = autoOn ? 'ì˜¤í† ëª¨ë“œ ON' : 'ì˜¤í† ëª¨ë“œ OFF'; label.className = 'auto-toggle-label' + (autoOn ? ' on' : ''); }
      if (modeBadge) { modeBadge.textContent = autoOn ? 'ğŸŸ¢ ìŠ¤ì¼€ì¤„ ìë™ ì‹¤í–‰ ì¤‘' : 'ìˆ˜ë™ ì‹¤í–‰ ì „ìš©'; modeBadge.style.color = autoOn ? '#68d391' : '#4a5568'; }

      // ì‹¤í–‰ ì™„ë£Œ ê°ì§€ â†’ ìˆ˜ì§‘ ë¦¬ìŠ¤íŠ¸ ìë™ ìƒˆë¡œê³ ì¹¨
      const wasRunning = window._wasRunning ?? false;
      window._wasRunning = status.running;
      if (wasRunning && !status.running) {
        loadCollected();
      }

      const statusEl = document.getElementById('statusText');
      if (status.running) {
        statusEl.textContent = status.progress ? 'ğŸ”„ ' + status.progress : 'ğŸ”„ ì‹¤í–‰ ì¤‘...';
        statusEl.style.color = '#63b3ed';
      } else {
        statusEl.textContent = 'ëŒ€ê¸° ì¤‘';
        statusEl.style.color = '';
      }

      document.getElementById('lastRun').textContent = status.lastRun
        ? new Date(status.lastRun).toLocaleString('ko-KR') : 'ì—†ìŒ';

      const resultEl = document.getElementById('lastResult');
      if (status.lastResult) {
        if (status.lastResult.summary) {
          resultEl.textContent = status.lastResult.summary;
          resultEl.style.color = status.lastResult.error ? '#fc8181' : '#9ae6b4';
        } else if (status.lastResult.error) {
          resultEl.textContent = 'âŒ ' + status.lastResult.error;
          resultEl.style.color = '#fc8181';
        }
      } else {
        resultEl.textContent = 'â€”';
        resultEl.style.color = '';
      }

      document.getElementById('btnRunType1').disabled = status.running;
      document.getElementById('btnRunType2').disabled = status.running;

      // ì˜µì…˜
      document.getElementById('optN').value = options.trackNTotal;
      document.getElementById('optM').value = options.trackMPerCategory;
      document.getElementById('optX').value = options.dedupDays;
      document.getElementById('optDelay').value = options.analysisDelayMs;
    } catch (e) {}
  }

  function fmt24(dateStr) {
    if (!dateStr) return 'â€”';
    const d = new Date(dateStr);
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const hh = String(d.getHours()).padStart(2,'0');
    const mi = String(d.getMinutes()).padStart(2,'0');
    return `${d.getFullYear()}-${mm}-${dd} ${hh}:${mi}`;
  }

  function scoreCell(val) {
    if (val == null) return '<span class="score-none">â€”</span>';
    const cls = val >= 70 ? 'score-high' : val >= 40 ? 'score-mid' : 'score-low';
    return `<span class="score ${cls}">${val}</span>`;
  }

  function aggroCell(val) {
    if (val == null) return '<span class="score-none">â€”</span>';
    // ì–´ê·¸ë¡œëŠ” ë†’ì„ìˆ˜ë¡ ë‚˜ìœ ê²ƒ â†’ ì—­ì‚°
    const cls = val >= 70 ? 'score-low' : val >= 40 ? 'score-mid' : 'score-high';
    return `<span class="score ${cls}">${val}</span>`;
  }

  async function loadCollected() {
    const wrap = document.getElementById('tableWrap');
    try {
      const res = await fetch('/api/collected');
      const { items } = await res.json();

      if (!items || items.length === 0) {
        wrap.innerHTML = '<div class="empty">ì•„ì§ ìˆ˜ì§‘ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      const rows = items.map(item => {
        const resultUrl  = `https://aggrofilter.com/p-result?id=${item.f_id}`;
        const chId  = item.f_channel_id || '';
        const chUrl = chId ? `https://www.youtube.com/channel/${chId}` : '#';
        const chName = escHtml(item.f_channel_name || chId.substring(0,14) || 'â€”');

        const gwTip = (item.f_grounding_queries || []).join(', ');
        const grounding = item.f_grounding_used
          ? `<span class="score" style="background:#1e3a5f;color:#90cdf4;font-size:12px;white-space:nowrap" title="${escHtml(gwTip)}">ğŸ” ê²€ìƒ‰</span>`
          : `<span class="score" style="background:#1e2335;color:#718096;font-size:12px;white-space:nowrap">ğŸ’­ ì¶”ë¡ </span>`;

        const CAT_MAP = {
          '1':'í•„ë¦„/ì• ë‹ˆ(1)','2':'ìë™ì°¨(2)','10':'ìŒì•…(10)','15':'ë™ë¬¼(15)',
          '17':'ìŠ¤í¬ì¸ (17)','19':'ì—¬í–‰(19)','20':'ê²Œì„(20)','22':'ì¸ë¬¼/ë¸”ë¡œê·¸(22)',
          '23':'ì½”ë¯¸ë””(23)','24':'ì˜¤ë½(24)','25':'ë‰´ìŠ¤/ì •ì¹˜(25)','26':'ë…¸í•˜ìš°(26)',
          '27':'êµìœ¡(27)','28':'ê³¼í•™/ê¸°ìˆ (28)','29':'ë¹„ì˜ë¦¬(29)'
        };
        const catId = String(item.f_category || '');
        const cat = catId && catId !== 'null' ? escHtml(CAT_MAP[catId] || catId) : 'â€”';

        return `
          <tr>
            <td class="cell-time">${fmt24(item.f_created_at)}</td>
            <td class="cell-ch"><a href="${chUrl}" target="_blank" title="${escHtml(chId)}">${chName}</a></td>
            <td class="cell-title"><a href="${resultUrl}" target="_blank">${escHtml(item.f_video_title || 'â€”')}</a></td>
            <td style="white-space:nowrap;color:#a0aec0">${cat}</td>
            <td style="text-align:center">${scoreCell(item.f_reliability_score)}</td>
            <td style="text-align:center">${scoreCell(item.f_accuracy_score)}</td>
            <td style="text-align:center">${aggroCell(item.f_clickbait_score)}</td>
            <td style="text-align:center">${grounding}</td>
          </tr>`;
      }).join('');

      wrap.innerHTML = `
        <table>
          <thead>
            <tr>
              <th style="width:130px">ì¼ì‹œ</th>
              <th style="width:120px">ì±„ë„</th>
              <th>ì˜ìƒ ì œëª©</th>
              <th style="width:110px">ì¹´í…Œê³ ë¦¬</th>
              <th style="width:66px;text-align:center">ì‹ ë¢°ë„</th>
              <th style="width:66px;text-align:center">ì •í™•ë„</th>
              <th style="width:66px;text-align:center">ì–´ê·¸ë¡œ</th>
              <th style="width:80px;text-align:center">ê·¸ë¼ìš´ë”©</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>`;
    } catch (e) {
      wrap.innerHTML = `<div class="empty">ì˜¤ë¥˜: ${e.message}</div>`;
    }
  }

  async function toggleAutoMode(checkbox) {
    try {
      const res = await fetch('/api/automode', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ enabled: checkbox.checked }),
      });
      const data = await res.json();
      showToast(data.autoMode ? 'ì˜¤í† ëª¨ë“œ ON â€” ìŠ¤ì¼€ì¤„ ìë™ ì‹¤í–‰ í™œì„±í™”' : 'ì˜¤í† ëª¨ë“œ OFF â€” ìˆ˜ë™ ì‹¤í–‰ ì „ìš©', data.autoMode ? 'ok' : '');
    } catch (e) {
      showToast('ì˜¤í† ëª¨ë“œ ë³€ê²½ ì‹¤íŒ¨: ' + e.message, 'err');
    }
  }

  async function saveOptions() {
    const body = {
      trackNTotal: document.getElementById('optN').value,
      trackMPerCategory: document.getElementById('optM').value,
      dedupDays: document.getElementById('optX').value,
      analysisDelayMs: document.getElementById('optDelay').value,
    };
    try {
      const res = await fetch('/api/options', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
      });
      const data = await res.json();
      showToast('ì˜µì…˜ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'ok');
    } catch (e) {
      showToast('ì €ì¥ ì‹¤íŒ¨: ' + e.message, 'err');
    }
  }

  async function runNow(type) {
    const endpoint = type === 'type1' ? '/api/run-type1' : '/api/run-type2';
    const btnId = type === 'type1' ? 'btnRunType1' : 'btnRunType2';
    document.getElementById(btnId).disabled = true;
    try {
      const res = await fetch(endpoint, { method: 'POST' });
      const data = await res.json();
      showToast(data.message, data.ok ? 'ok' : 'err');
      if (data.ok) {
        fetchStatus();
        pollingTimer = setInterval(() => { fetchStatus(); }, 3000);
        setTimeout(() => { clearInterval(pollingTimer); loadCollected(); }, 60000);
      } else {
        document.getElementById(btnId).disabled = false;
      }
    } catch (e) {
      showToast('ì‹¤í–‰ ì˜¤ë¥˜: ' + e.message, 'err');
      document.getElementById(btnId).disabled = false;
    }
  }

  function showToast(msg, type = '') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast show ' + type;
    setTimeout(() => { t.className = 'toast'; }, 3000);
  }

  function escHtml(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ íƒ­ ì „í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(name, btn) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
    document.getElementById('tab-' + name).classList.add('active');
    btn.classList.add('active');
    if (name === 'community') loadTargets();
    if (name === 'comments') loadCommentLogs();
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì»¤ë®¤ë‹ˆí‹° íƒ€ê²Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadTargets() {
    const wrap = document.getElementById('targetList');
    try {
      const res = await fetch('/api/community-targets');
      const { items } = await res.json();
      if (!items || items.length === 0) {
        wrap.innerHTML = '<div class="empty">ë“±ë¡ëœ íƒ€ê²Ÿì´ ì—†ìŠµë‹ˆë‹¤.<br>ìœ„ í¼ì—ì„œ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</div>';
        return;
      }
      const rows = items.map(t => {
        const kws = (t.keywords || []).map(k => `<span class="kw-badge">${escHtml(k)}</span>`).join('');
        const activeLabel = t.is_active
          ? '<span style="color:#48bb78;font-size:12px">â— í™œì„±</span>'
          : '<span style="color:#718096;font-size:12px">â—‹ ë¹„í™œì„±</span>';
        return `
          <tr>
            <td style="max-width:240px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">
              <a href="${escHtml(t.url)}" target="_blank" style="color:#63b3ed;font-size:12px">${escHtml(t.url)}</a>
            </td>
            <td>${kws || '<span style="color:#4a5568">â€”</span>'}</td>
            <td style="white-space:nowrap">${activeLabel}</td>
            <td style="color:#718096;font-size:11px">${escHtml(t.note || 'â€”')}</td>
            <td style="white-space:nowrap">
              <button class="btn btn-sm" style="background:#2d3748;color:#e2e8f0"
                onclick="toggleTarget(${t.id}, ${!t.is_active})">${t.is_active ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}</button>
              <button class="btn btn-sm btn-danger" onclick="deleteTarget(${t.id})" style="margin-left:4px">ì‚­ì œ</button>
            </td>
          </tr>`;
      }).join('');
      wrap.innerHTML = `
        <table>
          <thead><tr>
            <th>URL</th><th>í‚¤ì›Œë“œ</th><th>ìƒíƒœ</th><th>ë©”ëª¨</th><th>ê´€ë¦¬</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    } catch (e) {
      wrap.innerHTML = `<div class="empty">ì˜¤ë¥˜: ${e.message}</div>`;
    }
  }

  async function addTarget() {
    const url = document.getElementById('newUrl').value.trim();
    const keywords = document.getElementById('newKeywords').value.trim();
    const note = document.getElementById('newNote').value.trim();
    if (!url) { showToast('URLì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.', 'err'); return; }
    try {
      const res = await fetch('/api/community-targets', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url, keywords, note, is_active: true }),
      });
      const data = await res.json();
      if (data.ok) {
        document.getElementById('newUrl').value = '';
        document.getElementById('newKeywords').value = '';
        document.getElementById('newNote').value = '';
        showToast('íƒ€ê²Ÿì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'ok');
        loadTargets();
      } else {
        showToast('ì¶”ê°€ ì‹¤íŒ¨: ' + (data.error || ''), 'err');
      }
    } catch (e) {
      showToast('ì˜¤ë¥˜: ' + e.message, 'err');
    }
  }

  async function toggleTarget(id, newActive) {
    try {
      await fetch('/api/community-targets', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, is_active: newActive }),
      });
      loadTargets();
    } catch (e) {
      showToast('ì˜¤ë¥˜: ' + e.message, 'err');
    }
  }

  async function deleteTarget(id) {
    if (!confirm('ì´ íƒ€ê²Ÿì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    try {
      await fetch(`/api/community-targets/${id}`, { method: 'DELETE' });
      showToast('ì‚­ì œ ì™„ë£Œ', 'ok');
      loadTargets();
    } catch (e) {
      showToast('ì˜¤ë¥˜: ' + e.message, 'err');
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ëŒ“ê¸€ ë¡œê·¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadCommentLogs() {
    const wrap = document.getElementById('commentLogWrap');
    const status = document.getElementById('logStatusFilter')?.value || '';
    try {
      const res = await fetch('/api/comment-logs' + (status ? `?status=${status}` : ''));
      const { items } = await res.json();
      if (!items || items.length === 0) {
        wrap.innerHTML = '<div class="empty">ëŒ“ê¸€ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      const dotMap = { queue: 'dot-queue', done: 'dot-done', error: 'dot-error', skipped: 'dot-skipped' };
      const labelMap = { queue: 'ëŒ€ê¸°', done: 'ì™„ë£Œ', error: 'ì˜¤ë¥˜', skipped: 'ìŠ¤í‚µ' };
      const rows = items.map(item => {
        const dot = dotMap[item.status] || '';
        const label = labelMap[item.status] || item.status;
        const date = item.created_at ? new Date(item.created_at).toLocaleString('ko-KR') : 'â€”';
        const typeLabel = item.target_type === 'youtube' ? 'ğŸ¬ ìœ íŠœë¸Œ' : 'ğŸ’¬ ì»¤ë®¤ë‹ˆí‹°';
        const textPreview = (item.generated_text || '').substring(0, 60) + ((item.generated_text || '').length > 60 ? '...' : '');
        return `
          <tr>
            <td style="white-space:nowrap;font-size:11px">${typeLabel}</td>
            <td style="font-size:11px;color:#718096">${escHtml(item.grade || 'â€”')}</td>
            <td style="max-width:300px;font-size:12px">${escHtml(textPreview)}</td>
            <td><span class="status-dot ${dot}"></span>${label}</td>
            <td style="color:#718096;font-size:11px">${date}</td>
          </tr>`;
      }).join('');
      wrap.innerHTML = `
        <table>
          <thead><tr>
            <th>ìœ í˜•</th><th>ë“±ê¸‰</th><th>ìƒì„± í…ìŠ¤íŠ¸</th><th>ìƒíƒœ</th><th>ì‹œê°</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    } catch (e) {
      wrap.innerHTML = `<div class="empty">ì˜¤ë¥˜: ${e.message}</div>`;
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê°€ì´ë“œ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openGuide() {
    document.getElementById('guideModal').classList.add('open');
  }
  function closeGuide() {
    document.getElementById('guideModal').classList.remove('open');
  }
  function closeGuideOutside(e) {
    if (e.target === document.getElementById('guideModal')) closeGuide();
  }
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeGuide();
  });

  // ì´ˆê¸° ë¡œë“œ
  fetchStatus();
  loadCollected();
  setInterval(fetchStatus, 10000);
</script>
</body>
</html>
