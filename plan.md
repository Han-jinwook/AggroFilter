# 프로젝트 진행 상황 및 계획

## ✅ 완료된 작업 (2026-01-08)

### 1. 청소년 분석 서비스 고도화
- **프롬프트 전달 방식 개선**:
  - URL 길이 제한 문제 해결을 위해 **하이브리드 방식** 적용.
  - 내용이 길 경우(자막 전문 포함) 자동으로 **클립보드에 복사**하고 ChatGPT를 실행하도록 변경.
- **프롬프트 내용 강화**:
  - [자막 전문] 섹션을 추가하여 AI가 전체 맥락을 파악하고 교육할 수 있도록 개선.

### 2. 어그로성 평가 로직 전면 개편 (Gemini v4.3)
- **문제점 해결**: 정확도가 높으면 어그로 점수가 낮아지는 '기계적 감경' 문제 해결.
- **주요 변경 사항**:
  - **상대적 평가 도입**: '팩트의 무게'와 '워딩의 무게' 사이의 **괴리감(Gap)**을 평가.
  - **평가 독립성**: 내용이 정확해도 워딩이 과장되면 고득점 부여.
  - **Fact Cap(상한선) 적용**: 팩트가 기반된 영상은 아무리 과장되어도 **최대 90점**으로 제한 (100점은 허위사실 전용).
  - **구간 제한 해제**: 인위적인 점수 가이드를 삭제하고 AI의 자율 평가 비중 확대.

### 3. 멀티모달(썸네일+텍스트) 분석 기능 추가
- **기능 구현 (기술적 특이사항)**:
  - **Fetch & Send 방식 채택**: Gemini API는 보안상 외부 URL 직접 입력을 지원하지 않음. 따라서 서버에서 썸네일을 다운로드(Fetch)하여 Base64 형태로 AI에 전달하도록 구현.
  - **비용 효율성 확보**: 전송 방식 변경에 따른 추가 과금 없음(장당 토큰 과금). GPT-4o 대비 60배 저렴한 Flash 모델 유지로 운영 비용 최소화.
- **분석 기준 강화**:
  - **시각적 어그로 평가**: 붉은색 텍스트, 과한 표정 합성, 자극적 문구 등 시각적 요소를 '괴리감(Gap)' 평가에 포함.
  - **Gap 분석 확장**: [팩트] vs [제목 + 썸네일] 간의 괴리감을 종합적으로 판단하도록 프롬프트 고도화.

### 4. 긴급 모델 교체 및 재난 이슈 분류 강화 (2026-01-10)
- **AI 모델 전면 교체**: 
  - 기존 `gemini-1.5-pro`의 404 오류 및 타임아웃 문제 해결을 위해 최신 **`gemini-2.5-flash`** (Primary) 및 **`gemini-2.0-flash-lite`** (Fallback) 체제로 전환.
- **주제 분류 정확도 개선 (재난 이슈)**:
  - **문제점**: 지진/쓰나미 등 명백한 재난 영상을 AI가 '지구 과학'이나 '환경 문제'로 오분류하는 현상 발생.
  - **해결책**: 
    1. 프롬프트에 '지진은 환경 문제가 아님'을 명시하고 '재난 이슈' 우선순위 강화.
    2. **Code-Level Fail-safe 도입**: AI가 오분류하더라도 제목/자막에 '지진', '대피', '쓰나미' 등 재난 키워드가 포함되면 강제로 **"재난 이슈"**로 보정하는 이중 안전장치 구축.
- **시스템 안정성 확보**:
  - 응답 JSON 파싱 로직 강화 (마크다운/공백 제거).
  - 주제 표준화 단계 타임아웃 시에도 분석 결과는 보존하도록 수정.

### 5. 분석수 및 조회수 카운팅 로직 확정 (2026-01-13)
- **분석수 (`f_request_count`)**:
  - 유저가 URL을 입력창에 넣고 분석을 요청할 때 발생.
  - 최초 분석뿐만 아니라, 이미 DB에 있는 영상을 다시 URL로 입력하여 호출하는 경우도 '분석 활동'으로 간주하여 카운트 증가.
  - 분석 요청 시 **조회수도 동시에 1 증가**함.
- **조회수 (`f_view_count`)**:
  - 메인, 플라자, 랭킹 등 모든 페이지/섹션에서 **영상 제목을 클릭**하여 상세 분석 결과 페이지로 진입할 때 무조건 1 카운트 증가.
- **표시 로직**:
  - 사용자에게 노출되는 '조회수' 수치는 `분석수 + 조회수`를 합산하여 서비스 활성도를 직관적으로 표현함.

## ✅ 완료된 작업 (2026-01-19)

### 1. 글로벌 랭킹 엔진 및 Smart Locale Strategy (v2.0)
- **랭킹 키(Ranking Key) 체계 혁신**:
  - **Case A (고립어: ko, ja)**: 국가 정보를 무시하고 언어권 전체를 하나로 통합하여 경쟁 (예: 전 세계 한국어 유튜버 통합 랭킹).
  - **Case B (범용어: en, es, fr 등)**: [언어+국가]를 조합하여 국가별 별도 리그 운영 (예: 미국 뉴스 vs 영국 뉴스 랭킹 분리).
- **데이터 구조 최적화**: `t_rankings_cache` 및 `t_channels` 테이블에 언어(`f_language`), 국가(`f_country`) 필드를 추가하여 글로벌 확장성 확보.

### 2. Youtube Native 기반 주제 분류 시스템 단순화
- **AI 태그(Topic) 기능 전면 제거**: 불확실한 AI 추측 대신 유튜브 공식 API의 `category_id`를 절대 기준으로 사용.
- **UI 일원화**: 기존의 AI 태그 자리에 "뉴스/정치", "과학기술" 등 공식 카테고리 명칭(한글)을 매핑하여 신뢰도 향상.
- **검색 효율성**: 불필요한 태그 인덱싱을 제거하고 채널명/제목 중심의 검색 엔진으로 최적화.

### 3. 신뢰도 평가 로직 고도화 (Fact-Based Gap Analysis)
- **Accuracy Cap (상한선) 적용**: 정확도(Accuracy) 점수에 따라 어그로 점수의 가용 범위를 강제 제한하여 논리적 정합성 확보.
  - **Green (70+)**: 어그로 0~30점 강제 (팩트가 확실하면 포장은 용인).
  - **Yellow (40-69)**: 어그로 0~60점 (과장 정도에 따른 유동적 평가).
  - **Red (0-39)**: 어그로 0~100점 (거짓 정보는 구제 불능).
- **논리 일치성 절대 준수**: 자극적 단어를 써도 팩트면 0점, 점잖은 표현이어도 거짓이면 100점 부여.

### 4. 상세 페이지 UX 혁신 (스마트 뷰어)
- **타임스탬프 점핑(Jump) 기능**: 요약 내용의 타임스탬프 클릭 시 영상의 해당 지점으로 즉시 이동하는 기능 구현.
- **임베드 플레이어 최적화**: 
  - 평상시에는 플레이어를 숨겨 리포트 가독성 확보.
  - 타임스탬프 클릭 시에만 상단에서 부드럽게 나타나는 **On-Demand** 방식 적용.
  - 닫기 버튼 추가 및 Sticky 해제로 모바일/PC 통합 UX 개선.

### 5. DB 스키마 및 API 최적화
- **스키마 정리**: 사용하지 않는 `f_topic` 컬럼을 모든 테이블에서 삭제하여 데이터 구조 간소화.
- **통계 로직 개편**: `t_channel_stats`의 기본 키(PK)를 `(채널ID + 카테고리ID)`로 변경하여 정확한 카테고리별 통계 산출.
- **API 연동**: 분석 결과 조회 API에서 누락되었던 공식 카테고리 정보를 보강하여 UI와 100% 동기화.

## 📅 향후 계획
- [ ] 글로벌 다국어 런칭을 위한 다국어 UI(i18n) 작업 검토
- [ ] 랭킹 페이지 내 국가별/언어별 필터링 UI 추가
- [ ] 팩트 체크 근거 자료(Source) 자동 추출 기능 실험

